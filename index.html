<!doctype html>
<html>
  <head>
    <link rel="stylesheet" href="index.css" />
    <link rel="icon" href="./favicon.ico" />
  </head>

  <body>
    <div class="main">
        <p style="display:none;" id="badcode">not playing</p>
        <video class="bigVid" id="mediaElement" autoplay></video>
        <div id="leftButtons">
          <button id="newBtn">New</button>
          <button id="startBtn">Start</button>
          <button id="closeBtn">Close</button>
          <button id="speachBtn">Speech</button>
        </div>

        <div id="statusBlock">
            <label>
                AvatarID
                <input id="avatarID" type="text" value="Wayne_20240711"/>
            </label>
    
            <label>
                VoiceID
                <input id="voiceID" type="text" value="080d9383c0314056aef392892e009806"/>
            </label>

            <label>
                Language
                <select style="width: 8vw;" name="languageDrop" id="languageDrop">
                    <option value="English">English</option>
                    <option value="Chinese">Chinese</option>
                    <option value="Japanese">Japanese</option>
                    <option value="German">German</option>
                    <option value="French">French</option>
                    <option value="Spanish">Spanish</option>
                    <option value="Italian">Italian</option>
                </select>
            </label>  
            <label>
              Message
              <input id="taskInput" type="text" />
            </label>
            <button id="repeatBtn">Repeat</button>
            <button id="talkBtn">Talk</button>

            <p style="color: yellow;" id="status"></p>
            <div style="color: yellow;" id="output"></div>
        </div>

        <div id="qrBlock">
          <h1>Scan to access Deloitte's career website</h1>
          <div id="qrCode"></div>
        </div>
    </div>

    <script type="module" src="index.js"></script>
    <script type="module" src="qrcode.js"></script>
    <script>
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition || window.mozSpeechRecognition || window.msSpeechRecognition)();
        
        //determines recognition language based on dropdown selection
        var selector = document.getElementById("languageDrop");
        var selectedLang = selector.value;
        recognition.lang = "en-US";
        
        selector.addEventListener("change", function(){
          var selectedLang = this.value;
          console.log(selectedLang);
          if (selectedLang == "English"){
            recognition.lang = "en-US";
          }
          if (selectedLang == "Chinese"){
            recognition.lang = "zh-TW";
          }
          if (selectedLang == "Japanese"){
            recognition.lang = "ja";
          }
          if (selectedLang == "German"){
            recognition.lang = "de";
          }
          if (selectedLang == "French"){
            recognition.lang = "fr";
          }
          if (selectedLang == "Italian"){
            recognition.lang = "it";
          }
          if (selectedLang == "Spanish"){
            recognition.lang = "es";
          }
        });
        
        

        const startButton = document.getElementById('speachBtn');
        const outputDiv = document.getElementById('output');
        const taskInput = document.getElementById('taskInput');
        const talkBtn = document.getElementById('talkBtn');
        recognition.onstart = () => {
            startButton.textContent = 'Listening...';
        };

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            taskInput.value = transcript;
            talkBtn.click();
            // outputDiv.textContent = transcript;
        };

        recognition.onend = () =>{
          startButton.textContent = 'Start Voice Input';
        };

        startButton.addEventListener('click', () =>{
          recognition.start();
        });

        addEventListener("keydown", function(e){;

          //checks if Wayne is on screen
          if(document.getElementById("badcode").innerHTML=="playing"){
            //lets user start talking by pressing the "s" key
            if(e.key == "s"){
              recognition.start();
            }

            //lets user hide the status bar by pressing the "h" key
            if(e.key == "h"){
            var statusBlock = document.getElementById("statusBlock");
            var leftButtons = document.getElementById("leftButtons");
            if (statusBlock.style.display !="none" && leftButtons.style.display !="none"){
              statusBlock.style.display = "none";
              leftButtons.style.display = "none";
            }
            else{
              statusBlock.style.display = "flex";
              leftButtons.style.display = "initial";
            }
          }
          };
        });

        
        

        
    </script>
  </body>
</html>